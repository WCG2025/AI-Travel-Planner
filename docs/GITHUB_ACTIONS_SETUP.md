# GitHub Actions è‡ªåŠ¨æ„å»ºé…ç½®æŒ‡å—

## ğŸ¯ ç›®æ ‡

é€šè¿‡ GitHub Actions è‡ªåŠ¨æ„å»º Docker é•œåƒå¹¶æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒä»“åº“ã€‚

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡

#### ç¬¬ä¸€æ­¥ï¼šå¼€é€šæœåŠ¡

1. ç™»å½• [é˜¿é‡Œäº‘æ§åˆ¶å°](https://www.aliyun.com/)
2. æœç´¢"å®¹å™¨é•œåƒæœåŠ¡ ACR"
3. é€‰æ‹©"ä¸ªäººç‰ˆ"ï¼ˆå…è´¹ï¼‰
4. å¼€é€šæœåŠ¡

#### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå‘½åç©ºé—´

1. è¿›å…¥å®¹å™¨é•œåƒæœåŠ¡æ§åˆ¶å°
2. é€‰æ‹©åœ°åŸŸï¼ˆå¦‚ï¼šåä¸œ1-æ­å·ï¼‰
3. åˆ›å»ºå‘½åç©ºé—´ï¼š
   - å‘½åç©ºé—´åç§°ï¼šä¾‹å¦‚ `ai-travel-planner` æˆ–æ‚¨çš„ç”¨æˆ·å
   - è®°å½•å‘½åç©ºé—´åç§°ï¼ˆåç»­éœ€è¦ï¼‰

#### ç¬¬ä¸‰æ­¥ï¼šè·å–è®¿é—®å‡­è¯

1. åœ¨æ§åˆ¶å°å³ä¸Šè§’ â†’ è®¿é—®å‡­è¯
2. è®¾ç½® Registry ç™»å½•å¯†ç 
3. è®°å½•ï¼š
   - ç”¨æˆ·åï¼ˆé€šå¸¸æ˜¯é˜¿é‡Œäº‘è´¦å·å…¨åï¼‰
   - å¯†ç ï¼ˆåˆšè®¾ç½®çš„ï¼‰
   - Registry åœ°å€ï¼š`registry.cn-hangzhou.aliyuncs.com`

---

### 2. é…ç½® GitHub Secrets

#### ç¬¬ä¸€æ­¥ï¼šè¿›å…¥ GitHub ä»“åº“è®¾ç½®

1. æ‰“å¼€æ‚¨çš„ GitHub ä»“åº“
2. ç‚¹å‡» `Settings`ï¼ˆè®¾ç½®ï¼‰
3. å·¦ä¾§èœå•é€‰æ‹© `Secrets and variables` â†’ `Actions`

#### ç¬¬äºŒæ­¥ï¼šæ·»åŠ  Secrets

ç‚¹å‡» `New repository secret`ï¼Œæ·»åŠ ä»¥ä¸‹ 3 ä¸ªå¯†é’¥ï¼š

| Secret åç§° | å€¼ | è¯´æ˜ |
|------------|---|------|
| `ALIYUN_REGISTRY_USERNAME` | æ‚¨çš„é˜¿é‡Œäº‘ç”¨æˆ·å | ç”¨äºç™»å½•é•œåƒä»“åº“ |
| `ALIYUN_REGISTRY_PASSWORD` | æ‚¨è®¾ç½®çš„å¯†ç  | ç”¨äºç™»å½•é•œåƒä»“åº“ |
| `ALIYUN_NAMESPACE` | å‘½åç©ºé—´åç§° | ä¾‹å¦‚ï¼šai-travel-planner |

**ç¤ºä¾‹**ï¼š
```
Name: ALIYUN_REGISTRY_USERNAME
Secret: your_aliyun_account@example.com

Name: ALIYUN_REGISTRY_PASSWORD  
Secret: your_registry_password

Name: ALIYUN_NAMESPACE
Secret: ai-travel-planner
```

---

## ğŸš€ è§¦å‘æ„å»º

### è‡ªåŠ¨è§¦å‘

GitHub Actions ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨æ„å»ºï¼š

1. **æ¨é€åˆ° main/master åˆ†æ”¯**
   ```bash
   git push origin main
   ```
   
2. **åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾**
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

### æ‰‹åŠ¨è§¦å‘

1. è¿›å…¥ GitHub ä»“åº“
2. ç‚¹å‡» `Actions` æ ‡ç­¾
3. é€‰æ‹© `Build and Push Docker Image`
4. ç‚¹å‡» `Run workflow` æŒ‰é’®
5. é€‰æ‹©åˆ†æ”¯ï¼Œç‚¹å‡» `Run workflow`

---

## ğŸ“Š æŸ¥çœ‹æ„å»ºçŠ¶æ€

### åœ¨ GitHub ä¸ŠæŸ¥çœ‹

1. è¿›å…¥ä»“åº“çš„ `Actions` æ ‡ç­¾
2. æŸ¥çœ‹æœ€æ–°çš„ workflow è¿è¡Œ
3. ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### æ„å»ºæ­¥éª¤

Workflow æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. âœ… Checkout codeï¼ˆæ£€å‡ºä»£ç ï¼‰
2. âœ… Set up Docker Buildxï¼ˆè®¾ç½®æ„å»ºå™¨ï¼‰
3. âœ… Login to Aliyunï¼ˆç™»å½•é˜¿é‡Œäº‘ï¼‰
4. âœ… Extract metadataï¼ˆæå–å…ƒæ•°æ®ï¼‰
5. âœ… Build and pushï¼ˆæ„å»ºå¹¶æ¨é€ï¼‰
6. âœ… Image digestï¼ˆæ˜¾ç¤ºé•œåƒæ‘˜è¦ï¼‰

**é¢„è®¡æ—¶é—´**ï¼šé¦–æ¬¡ ~10åˆ†é’Ÿï¼Œåç»­ ~3-5åˆ†é’Ÿï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰

---

## ğŸ” éªŒè¯é•œåƒå·²æ¨é€

### æ–¹æ³• 1ï¼šé˜¿é‡Œäº‘æ§åˆ¶å°

1. ç™»å½•é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
2. è¿›å…¥æ‚¨çš„å‘½åç©ºé—´
3. æŸ¥çœ‹ `ai-travel-planner` ä»“åº“
4. åº”è¯¥çœ‹åˆ°æœ€æ–°çš„é•œåƒæ ‡ç­¾

### æ–¹æ³• 2ï¼šæ‹‰å–é•œåƒæµ‹è¯•

```bash
# ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“
docker login registry.cn-hangzhou.aliyuncs.com

# æ‹‰å–é•œåƒ
docker pull registry.cn-hangzhou.aliyuncs.com/your-namespace/ai-travel-planner:latest

# æŸ¥çœ‹é•œåƒ
docker images | grep ai-travel-planner
```

---

## ğŸ“ é•œåƒæ ‡ç­¾è¯´æ˜

Workflow ä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ ‡ç­¾ï¼š

| æ ‡ç­¾ | ä½•æ—¶ç”Ÿæˆ | ç¤ºä¾‹ |
|------|---------|------|
| `latest` | æ¯æ¬¡æ¨é€åˆ° main | `latest` |
| `main` | æ¨é€åˆ° main åˆ†æ”¯ | `main` |
| `v1.0.0` | åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾ | `v1.0.0` |
| `v1.0` | åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾ | `v1.0` |

**æ¨èä½¿ç”¨**ï¼š
- å¼€å‘/æµ‹è¯•ï¼š`latest`
- ç”Ÿäº§ç¯å¢ƒï¼š`v1.0.0`ï¼ˆå›ºå®šç‰ˆæœ¬ï¼‰

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ„å»ºå¤±è´¥ - ç™»å½•é˜¿é‡Œäº‘å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Cannot perform an interactive login from a non TTY device
```

**åŸå› **ï¼šGitHub Secrets æœªæ­£ç¡®é…ç½®

**è§£å†³**ï¼š
1. æ£€æŸ¥ Secret åç§°æ˜¯å¦æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
2. æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤å·²è®¾ç½® Registry ç™»å½•å¯†ç 

### é—®é¢˜ 2ï¼šæ„å»ºå¤±è´¥ - æ‰¾ä¸åˆ°å‘½åç©ºé—´

**é”™è¯¯ä¿¡æ¯**ï¼š
```
unauthorized: authentication required
```

**åŸå› **ï¼šå‘½åç©ºé—´ä¸å­˜åœ¨æˆ–åç§°é”™è¯¯

**è§£å†³**ï¼š
1. åœ¨é˜¿é‡Œäº‘åˆ›å»ºå‘½åç©ºé—´
2. ç¡®è®¤ `ALIYUN_NAMESPACE` Secret ä¸å®é™…ä¸€è‡´

### é—®é¢˜ 3ï¼šæ¨é€æ…¢æˆ–è¶…æ—¶

**åŸå› **ï¼šç½‘ç»œé—®é¢˜æˆ–é•œåƒè¿‡å¤§

**è§£å†³**ï¼š
1. ä½¿ç”¨ GitHub Actions è‡ªå¸¦çš„ç¼“å­˜
2. ä¼˜åŒ– Dockerfileï¼ˆå·²ä¼˜åŒ–ï¼‰
3. é€‰æ‹©åˆé€‚çš„é˜¿é‡Œäº‘åœ°åŸŸ

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

åœ¨æ¨é€ä»£ç å‰ï¼Œç¡®è®¤ï¼š

- [ ] å·²å¼€é€šé˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
- [ ] å·²åˆ›å»ºå‘½åç©ºé—´
- [ ] å·²è®¾ç½® Registry ç™»å½•å¯†ç 
- [ ] å·²åœ¨ GitHub æ·»åŠ  3 ä¸ª Secrets
- [ ] Secrets åç§°æ‹¼å†™æ­£ç¡®
- [ ] Workflow æ–‡ä»¶å·²æäº¤ï¼ˆ`.github/workflows/docker-build.yml`ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ–‡æ¡£](https://help.aliyun.com/product/60716.html)
- [DOCKER_DEPLOYMENT.md](../DOCKER_DEPLOYMENT.md) - éƒ¨ç½²æŒ‡å—

---

## ğŸ“ ç»™è¯„å®¡è€å¸ˆ

### é•œåƒåœ°å€æ ¼å¼

```
registry.cn-hangzhou.aliyuncs.com/[å‘½åç©ºé—´]/ai-travel-planner:latest
```

### æ‹‰å–å’Œè¿è¡Œ

```bash
# æ‹‰å–é•œåƒ
docker pull registry.cn-hangzhou.aliyuncs.com/[å‘½åç©ºé—´]/ai-travel-planner:latest

# åˆ›å»º .env æ–‡ä»¶ï¼ˆé…ç½® API Keysï¼‰

# è¿è¡Œ
docker-compose up -d
```

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ `DOCKER_DEPLOYMENT.md`ã€‚

---

**é…ç½®å®Œæˆåï¼Œæ¯æ¬¡ git push éƒ½ä¼šè‡ªåŠ¨æ„å»ºå’Œæ¨é€é•œåƒï¼** ğŸš€

