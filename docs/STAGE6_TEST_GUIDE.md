# 第六阶段测试指南：地图与导航

## 📋 测试前准备

### 1. 确认环境配置

检查 `.env.local` 文件中的高德地图配置：

```env
NEXT_PUBLIC_AMAP_KEY=your_amap_key_here
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问 [http://localhost:3000](http://localhost:3000)

### 3. 准备测试数据

确保您有至少一个包含景点信息的旅行计划。如果没有，可以创建一个新计划。

---

## 🧪 测试清单

### ✅ 测试 1：地图基础加载

**目标**：验证地图能否正确加载和显示

**步骤**：
1. 登录系统
2. 进入"我的计划"
3. 打开任意旅行计划
4. 点击"地图导航"标签页

**预期结果**：
- ✅ 地图容器正常显示
- ✅ 地图加载动画出现
- ✅ 地图成功加载并显示
- ✅ 地图控件（缩放、比例尺）正常显示
- ✅ 可以拖动地图
- ✅ 可以缩放地图

**常见问题**：
- 如果显示"地图加载失败"，检查 API Key 配置
- 如果地图空白，查看浏览器控制台错误

---

### ✅ 测试 2：景点标记显示

**目标**：验证行程中的景点能否正确标记在地图上

**步骤**：
1. 在"地图导航"标签页
2. 等待地图加载完成
3. 观察地图上的标记点

**预期结果**：
- ✅ 行程中的景点在地图上显示为标记
- ✅ 不同类型的活动显示不同颜色的标记：
  - 🏛️ 景点：红色
  - 🍽️ 用餐：橙色
  - 🏨 住宿：蓝色
  - 🚗 交通：紫色
  - 🛍️ 购物：绿色
  - 🎭 娱乐：粉色
- ✅ 地图视野自动调整以包含所有标记
- ✅ 右上角显示图例

**测试场景**：
- 测试只有 1 个景点的情况
- 测试多个景点的情况
- 测试混合类型活动的情况

---

### ✅ 测试 3：景点信息窗口

**目标**：验证点击标记能否显示景点详情

**步骤**：
1. 在地图上点击任意标记
2. 观察信息窗口

**预期结果**：
- ✅ 弹出信息窗口
- ✅ 显示活动标题
- ✅ 显示活动时间
- ✅ 显示活动描述
- ✅ 显示地点位置（如有）
- ✅ 显示费用（如有）
- ✅ 信息格式清晰易读

**测试步骤**：
1. 点击不同标记，验证不同景点信息
2. 关闭信息窗口，点击另一个标记
3. 验证信息窗口正确切换

---

### ✅ 测试 4：路线规划显示

**目标**：验证地图能否显示景点间的路线

**步骤**：
1. 使用包含至少 2 个景点的旅行计划
2. 查看地图上是否显示路线

**预期结果**：
- ✅ 前两个景点之间显示路线（蓝色线条）
- ✅ 左下角显示路线信息卡片：
  - 显示距离（如：2.5公里）
  - 显示时间（如：35分钟）
- ✅ 路线清晰可见

**测试场景**：
- 近距离景点（< 1km）
- 中距离景点（1-5km）
- 远距离景点（> 5km）

---

### ✅ 测试 5：地理编码准确性

**目标**：验证地址能否正确转换为地图坐标

**步骤**：
1. 创建新的旅行计划，使用明确的地址：
   - 例如："北京天安门"
   - "上海东方明珠"
   - "成都宽窄巷子"
2. 查看地图标记位置

**预期结果**：
- ✅ 标记位置准确
- ✅ 与实际地理位置匹配
- ✅ 没有明显偏移

**如果位置不准确**：
- 检查行程中的地址信息是否完整
- 尝试使用更具体的地址
- 查看控制台是否有地理编码错误

---

### ✅ 测试 6：地图交互

**目标**：验证地图的各种交互功能

**步骤**：
1. 尝试拖动地图
2. 尝试缩放地图（鼠标滚轮）
3. 点击地图空白区域
4. 使用地图控件

**预期结果**：
- ✅ 可以平滑拖动地图
- ✅ 可以缩放地图（放大/缩小）
- ✅ 缩放控件正常工作
- ✅ 比例尺随缩放级别更新
- ✅ 指南针/工具栏正常显示

---

### ✅ 测试 7：加载状态

**目标**：验证加载和错误状态的显示

**步骤 A - 加载状态**：
1. 刷新页面
2. 观察地图加载过程

**预期结果**：
- ✅ 显示加载动画
- ✅ 显示"加载地图中..."文字
- ✅ 加载完成后自动消失

**步骤 B - 错误状态**：
1. 暂时移除或修改 `.env.local` 中的 `NEXT_PUBLIC_AMAP_KEY`
2. 刷新页面
3. 观察错误提示

**预期结果**：
- ✅ 显示错误提示
- ✅ 错误信息清晰说明问题
- ✅ 不会导致应用崩溃

---

### ✅ 测试 8：空数据处理

**目标**：验证没有景点信息时的处理

**步骤**：
1. 创建一个新计划，但不包含地点信息
2. 或修改现有计划，移除所有景点的地点信息
3. 查看地图标签页

**预期结果**：
- ✅ 显示友好的提示信息
- ✅ 不会报错或崩溃
- ✅ 建议用户添加地点信息

---

### ✅ 测试 9：响应式设计

**目标**：验证地图在不同屏幕尺寸下的表现

**步骤**：
1. 调整浏览器窗口大小
2. 测试以下尺寸：
   - 桌面（> 1200px）
   - 平板（768px - 1200px）
   - 手机（< 768px）

**预期结果**：
- ✅ 地图容器自适应屏幕宽度
- ✅ 地图高度合理
- ✅ 控件和信息卡片位置合适
- ✅ 标记和路线清晰可见
- ✅ 在小屏幕上信息卡片不遮挡地图

---

### ✅ 测试 10：性能测试

**目标**：验证地图性能和流畅度

**测试场景**：
1. 加载包含多个景点的计划（10+ 景点）
2. 快速切换标签页
3. 连续缩放和拖动地图

**预期结果**：
- ✅ 地图加载时间 < 3 秒
- ✅ 标记渲染流畅，无明显卡顿
- ✅ 地图交互响应及时
- ✅ 内存使用合理，无内存泄漏
- ✅ 切换标签页后地图正常销毁

---

## 🔍 调试技巧

### 1. 查看控制台日志

打开浏览器开发者工具（F12） → Console 标签

**正常加载日志示例**：
```
🗺️ 开始加载高德地图...
✅ 高德地图 API 加载成功
🗺️ 初始化地图实例...
✅ 地图实例初始化成功
🗺️ 开始为 5 个景点进行地理编码...
✅ 地理编码成功: 天安门 → (116.397428, 39.90923)
✅ 成功加载 5 个地点
```

### 2. 检查网络请求

开发者工具 → Network 标签

**应该看到的请求**：
- `webapi.amap.com` - 高德地图 API
- 地理编码请求（如果有）
- 地图瓦片图片

### 3. 检查地图实例

在浏览器控制台输入：
```javascript
window.AMap
```

应该返回高德地图的 AMap 对象。

---

## 🐛 常见问题排查

### 问题 1：地图显示空白

**可能原因**：
- API Key 未配置或错误
- 网络问题
- 浏览器兼容性问题

**解决方法**：
1. 检查 `.env.local` 配置
2. 查看浏览器控制台错误
3. 尝试刷新页面
4. 使用其他浏览器测试

### 问题 2：标记位置不对

**可能原因**：
- 地址信息不完整
- 地理编码不准确
- 坐标偏移

**解决方法**：
1. 使用更具体的地址
2. 包含城市信息
3. 如果有坐标，直接使用坐标

### 问题 3：路线不显示

**可能原因**：
- 景点数量 < 2
- 地理编码失败
- 路线规划 API 错误

**解决方法**：
1. 确保至少有 2 个景点
2. 检查景点地址是否有效
3. 查看控制台路线规划日志

### 问题 4：地图加载慢

**可能原因**：
- 网络速度慢
- 景点数量多
- 地理编码请求多

**优化建议**：
- 使用缓存
- 减少批量地理编码数量
- 优化地图初始化配置

---

## ✅ 测试完成检查清单

完成以下所有测试后，第六阶段功能验证完成：

- [ ] 地图基础加载正常
- [ ] 景点标记显示正确
- [ ] 景点信息窗口功能正常
- [ ] 路线规划显示正常
- [ ] 地理编码准确
- [ ] 地图交互流畅
- [ ] 加载状态显示正常
- [ ] 错误处理正确
- [ ] 空数据处理合理
- [ ] 响应式设计良好
- [ ] 性能表现优秀

---

## 📊 测试报告模板

```
【第六阶段地图功能测试报告】

测试时间：____年__月__日
测试环境：
- 浏览器：Chrome/Firefox/Safari ______
- 操作系统：Windows/Mac/Linux
- API Key：已配置 ✅ / 未配置 ❌

测试结果：
✅ 通过：__ 项
❌ 失败：__ 项
⚠️  警告：__ 项

详细问题：
1. [问题描述]
   - 复现步骤：
   - 错误信息：
   - 截图：

建议：
[改进建议]

测试人：______
```

---

**测试完成后，请查看总结文档！** 📖 [STAGE6_COMPLETION_SUMMARY.md](./STAGE6_COMPLETION_SUMMARY.md)

