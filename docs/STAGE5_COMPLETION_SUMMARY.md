# ç¬¬äº”é˜¶æ®µå¼€å‘å®Œæˆæ€»ç»“ âœ…

## ğŸ‰ å¼€å‘å®Œæˆ

**ç¬¬äº”é˜¶æ®µï¼šè´¹ç”¨é¢„ç®—ä¸ç®¡ç†** å·²ç»å®Œæˆå¼€å‘ï¼æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å’Œ UI ç»„ä»¶å·²å®ç°å¹¶æäº¤ã€‚

## âœ¨ å·²å®Œæˆçš„åŠŸèƒ½

### 1. åç«¯åŸºç¡€è®¾æ–½ âœ…

- **ç±»å‹å®šä¹‰** (`src/types/expense.types.ts`)
  - 7 ç§è´¹ç”¨ç±»åˆ«ï¼ˆäº¤é€šã€ä½å®¿ã€é¤é¥®ã€é—¨ç¥¨ã€è´­ç‰©ã€å¨±ä¹ã€å…¶ä»–ï¼‰
  - å®Œæ•´çš„ TypeScript æ¥å£å®šä¹‰
  - è´¹ç”¨ç»Ÿè®¡å’Œé¢„ç®—å¯¹æ¯”ç±»å‹

- **AI è´¹ç”¨è§£æå™¨** (`src/lib/ai/expense-parser.ts`)
  - åŸºäº DeepSeek API çš„è‡ªç„¶è¯­è¨€è§£æ
  - ä»è¯­éŸ³æ–‡æœ¬ä¸­æå–ï¼šé‡‘é¢ã€ç±»åˆ«ã€æè¿°ã€æ—¥æœŸ
  - æ™ºèƒ½ç½®ä¿¡åº¦è¯„ä¼°

- **API è·¯ç”±**
  - `/api/expenses` (GET/POST) - åˆ—è¡¨å’Œåˆ›å»º
  - `/api/expenses/[id]` (GET/PUT/DELETE) - è¯¦æƒ…ã€æ›´æ–°ã€åˆ é™¤
  - `/api/expenses/parse-voice` (POST) - è¯­éŸ³è§£æ

- **æ•°æ®åº“è¿ç§»** (`supabase/migrations/20251031_create_expenses_table.sql`)
  - `expenses` è¡¨å®šä¹‰
  - ç´¢å¼•ä¼˜åŒ–ï¼ˆplan_id, date, categoryï¼‰
  - RLS å®‰å…¨ç­–ç•¥ï¼ˆç”¨æˆ·æ•°æ®éš”ç¦»ï¼‰
  - è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³è§¦å‘å™¨

### 2. å‰ç«¯ Hooks âœ…

- **`use-expenses.ts`**
  - è´¹ç”¨ CRUD æ“ä½œ
  - è‡ªåŠ¨ç»Ÿè®¡è®¡ç®—
  - çŠ¶æ€ç®¡ç†å’Œé”™è¯¯å¤„ç†

- **`use-expense-stats.ts`**
  - å®æ—¶ç»Ÿè®¡æ•°æ®è®¡ç®—
  - é¢„ç®—å¯¹æ¯”åˆ†æ
  - åˆ†ç±»å’Œæ—¥æœŸç»´åº¦ç»Ÿè®¡

### 3. UI ç»„ä»¶ âœ…

#### æ ¸å¿ƒç»„ä»¶

- **`ExpenseList`** - è´¹ç”¨åˆ—è¡¨ä¸»ç»„ä»¶
  - ç©ºçŠ¶æ€å¤„ç†
  - CRUD æ“ä½œé›†æˆ
  - ç»Ÿè®¡å’Œå›¾è¡¨å±•ç¤º

- **`ExpenseForm`** - è´¹ç”¨è¡¨å•ï¼ˆåŒæ¨¡å¼ï¼‰
  - æ‰‹åŠ¨è¾“å…¥æ¨¡å¼
  - è¯­éŸ³è¾“å…¥æ¨¡å¼ï¼ˆé›†æˆ AI è§£æï¼‰
  - è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º

- **`ExpenseCard`** - è´¹ç”¨å¡ç‰‡
  - ç±»åˆ«å›¾æ ‡å’Œé¢œè‰²
  - é‡‘é¢æ ¼å¼åŒ–
  - ç¼–è¾‘/åˆ é™¤æ“ä½œ

#### ç»Ÿè®¡ç»„ä»¶

- **`ExpenseStatsCards`** - ç»Ÿè®¡å¡ç‰‡
  - æ€»æ”¯å‡º
  - å‰©ä½™é¢„ç®—ï¼ˆå¸¦é¢œè‰²çŠ¶æ€ï¼‰
  - è®°å½•æ•°å’Œå¹³å‡æ¶ˆè´¹
  - æ¶ˆè´¹åˆ†ç±»æ¦‚è§ˆ

#### å¯è§†åŒ–ç»„ä»¶

- **`ExpenseCategoryChart`** - åˆ†ç±»é¥¼å›¾
  - Recharts å®ç°
  - äº¤äº’å¼å›¾ä¾‹
  - ç™¾åˆ†æ¯”å’Œé‡‘é¢æ˜¾ç¤º

- **`ExpenseTrendChart`** - æ¯æ—¥è¶‹åŠ¿æŸ±çŠ¶å›¾
  - æ—¥æœŸæ’åº
  - é‡‘é¢å¯¹æ¯”
  - Tooltip è¯¦æƒ…

### 4. é›†æˆåˆ°è®¡åˆ’è¯¦æƒ…é¡µ âœ…

- **æ ‡ç­¾é¡µè®¾è®¡**
  - "è¡Œç¨‹å®‰æ’" æ ‡ç­¾
  - "è´¹ç”¨ç®¡ç†" æ ‡ç­¾
  - æ— ç¼åˆ‡æ¢

- **é¢„ç®—å…³è”**
  - è‡ªåŠ¨è¯»å–è®¡åˆ’é¢„ç®—
  - å®æ—¶é¢„ç®—å¯¹æ¯”

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

- **æ–°å¢æ–‡ä»¶**: 15 ä¸ª
- **ä»£ç è¡Œæ•°**: ~2500+ è¡Œ
- **ç»„ä»¶æ•°é‡**: 5 ä¸ªä¸»è¦ç»„ä»¶
- **API è·¯ç”±**: 4 ä¸ª
- **Hooks**: 2 ä¸ª
- **æ–‡æ¡£**: 3 ä¸ª

## ğŸ—‚ï¸ æ–‡ä»¶æ¸…å•

```
src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ expense.types.ts           # è´¹ç”¨ç±»å‹å®šä¹‰
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ ai/
â”‚       â””â”€â”€ expense-parser.ts      # AI è¯­éŸ³è§£æ
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ expenses/
â”‚       â”‚   â”œâ”€â”€ route.ts           # åˆ—è¡¨/åˆ›å»º API
â”‚       â”‚   â”œâ”€â”€ [id]/route.ts      # è¯¦æƒ…/æ›´æ–°/åˆ é™¤ API
â”‚       â”‚   â””â”€â”€ parse-voice/route.ts # è¯­éŸ³è§£æ API
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-expenses.ts            # è´¹ç”¨ç®¡ç† Hook
â”‚   â””â”€â”€ use-expense-stats.ts       # ç»Ÿè®¡è®¡ç®— Hook
â””â”€â”€ components/
    â””â”€â”€ features/
        â””â”€â”€ expenses/
            â”œâ”€â”€ expense-list.tsx   # åˆ—è¡¨ä¸»ç»„ä»¶
            â”œâ”€â”€ expense-form.tsx   # è¡¨å•ç»„ä»¶
            â”œâ”€â”€ expense-card.tsx   # å¡ç‰‡ç»„ä»¶
            â”œâ”€â”€ expense-stats.tsx  # ç»Ÿè®¡å¡ç‰‡
            â””â”€â”€ expense-chart.tsx  # å›¾è¡¨ç»„ä»¶

supabase/
â””â”€â”€ migrations/
    â””â”€â”€ 20251031_create_expenses_table.sql  # æ•°æ®åº“è¿ç§»

docs/
â”œâ”€â”€ STAGE5_SETUP.md                # é…ç½®æŒ‡å—
â”œâ”€â”€ STAGE5_DATABASE_SETUP.md       # æ•°æ®åº“è®¾ç½®
â””â”€â”€ STAGE5_TEST_GUIDE.md           # æµ‹è¯•æŒ‡å—
```

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### æ­¥éª¤ 1: åº”ç”¨æ•°æ®åº“è¿ç§» âš ï¸

**è¿™æ˜¯å¿…éœ€çš„æ­¥éª¤ï¼** è¯·æŒ‰ç…§ä»¥ä¸‹æ–‡æ¡£æ“ä½œï¼š

ğŸ“– **`docs/STAGE5_DATABASE_SETUP.md`**

ç®€è¦æ­¥éª¤ï¼š
1. ç™»å½• Supabase Dashboard
2. æ‰“å¼€ SQL Editor
3. å¤åˆ¶å¹¶æ‰§è¡Œè¿ç§» SQLï¼ˆåœ¨ `supabase/migrations/20251031_create_expenses_table.sql`ï¼‰
4. éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ

### æ­¥éª¤ 2: åŠŸèƒ½æµ‹è¯•

**å¼€å‘æœåŠ¡å™¨çŠ¶æ€**: âœ… å·²è¿è¡Œ (`http://localhost:3000`)

è¯·æŒ‰ç…§è¯¦ç»†çš„æµ‹è¯•æŒ‡å—è¿›è¡Œæµ‹è¯•ï¼š

ğŸ“– **`docs/STAGE5_TEST_GUIDE.md`**

æµ‹è¯•æ¸…å•ï¼š
- [ ] æ‰‹åŠ¨æ·»åŠ è´¹ç”¨
- [ ] è¯­éŸ³æ·»åŠ è´¹ç”¨
- [ ] ç¼–è¾‘å’Œåˆ é™¤è´¹ç”¨
- [ ] ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤º
- [ ] åˆ†ç±»é¥¼å›¾
- [ ] æ¯æ—¥è¶‹åŠ¿å›¾
- [ ] é¢„ç®—è¿›åº¦å’Œè­¦å‘Š
- [ ] ç©ºçŠ¶æ€æ˜¾ç¤º
- [ ] å¤šè®¡åˆ’éš”ç¦»
- [ ] å“åº”å¼è®¾è®¡
- [ ] é”™è¯¯å¤„ç†

### æ­¥éª¤ 3: æµ‹è¯•è¯­éŸ³è¾“å…¥ç¤ºä¾‹

åœ¨"æ·»åŠ è´¹ç”¨"çš„"è¯­éŸ³è¾“å…¥"æ ‡ç­¾é¡µä¸­ï¼Œå°è¯•ä»¥ä¸‹è¯­å¥ï¼š

```
âœ… "ä»Šå¤©åˆé¤èŠ±äº† 68 å—"
âœ… "æ‰“è½¦å»æœºåœº 120 å…ƒ"
âœ… "æ˜¨å¤©ä½é…’åº— 350"
âœ… "ä¹°äº†ç†ŠçŒ«åŸºåœ°é—¨ç¥¨ 120"
âœ… "è´­ç‰© 500"
âœ… "çœ‹äº†åœºç”µå½± 80 å—"
```

AI ä¼šè‡ªåŠ¨è§£æå‡ºï¼š
- ğŸ’° é‡‘é¢
- ğŸ·ï¸ ç±»åˆ«
- ğŸ“ æè¿°
- ğŸ“… æ—¥æœŸ

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½è¯­éŸ³è§£æ
- åŸºäº DeepSeek API
- è‡ªç„¶è¯­è¨€ç†è§£
- è‡ªåŠ¨ç±»åˆ«è¯†åˆ«
- ç›¸å¯¹æ—¥æœŸå¤„ç†ï¼ˆä»Šå¤©/æ˜¨å¤©ï¼‰

### 2. å®æ—¶ç»Ÿè®¡è®¡ç®—
- ä½¿ç”¨ `useMemo` ä¼˜åŒ–æ€§èƒ½
- å¤šç»´åº¦ç»Ÿè®¡ï¼ˆåˆ†ç±»ã€æ—¥æœŸã€é¢„ç®—ï¼‰
- åŠ¨æ€çŠ¶æ€è®¡ç®—ï¼ˆå®‰å…¨/è­¦å‘Š/è¶…æ”¯ï¼‰

### 3. å¯è§†åŒ–å›¾è¡¨
- Recharts åº“é›†æˆ
- å“åº”å¼è®¾è®¡
- äº¤äº’å¼ä½“éªŒ

### 4. å®‰å…¨è®¾è®¡
- RLS ç­–ç•¥ç¡®ä¿æ•°æ®éš”ç¦»
- æ‰€æœ‰ API éƒ½éªŒè¯ç”¨æˆ·èº«ä»½
- é˜²æ­¢è¶Šæƒè®¿é—®

### 5. ç”¨æˆ·ä½“éªŒ
- åŒè¾“å…¥æ¨¡å¼ï¼ˆæ‰‹åŠ¨/è¯­éŸ³ï¼‰
- ç©ºçŠ¶æ€å¼•å¯¼
- å³æ—¶åé¦ˆï¼ˆToast æç¤ºï¼‰
- é¢„ç®—è­¦å‘Šç³»ç»Ÿ

## ğŸ“ ä»£ç æäº¤è®°å½•

```bash
# ç¬¬ä¸€æ¬¡æäº¤ï¼šåŸºç¡€è®¾æ–½
feat(stage5): add expense management foundation
- Add expense type definitions and category mappings
- Implement AI expense parser for voice input
- Create CRUD API routes for expenses
- Add voice parsing API endpoint
- Install recharts for data visualization
- Document stage 5 setup and features

# ç¬¬äºŒæ¬¡æäº¤ï¼šUI ç»„ä»¶
feat(stage5): complete expense management UI components and integration
- Add expense statistics hook (use-expense-stats.ts)
- Create expense charts (category pie chart and trend bar chart)
- Create expense form with voice input support
- Create expense list with CRUD operations
- Integrate expense management into plan detail page with tabs
- Add database migration for expenses table
- Fix type consistency for BudgetComparison and ExpenseStats

# ç¬¬ä¸‰æ¬¡æäº¤ï¼šæ–‡æ¡£
docs(stage5): add test guide and database setup guide
```

## âš ï¸ é‡è¦æç¤º

1. **æ•°æ®åº“è¿ç§»æ˜¯å¿…éœ€çš„**ï¼šåœ¨æµ‹è¯•ä¹‹å‰ï¼Œå¿…é¡»å…ˆåº”ç”¨æ•°æ®åº“è¿ç§»ã€‚
2. **è¯­éŸ³åŠŸèƒ½éœ€è¦éº¦å…‹é£æƒé™**ï¼šæµè§ˆå™¨ä¼šè¯·æ±‚éº¦å…‹é£è®¿é—®æƒé™ã€‚
3. **AI è§£æéœ€è¦ç½‘ç»œ**ï¼šDeepSeek API è°ƒç”¨éœ€è¦äº’è”ç½‘è¿æ¥ã€‚
4. **é¢„ç®—æ˜¯å¯é€‰çš„**ï¼šå¯ä»¥åˆ›å»ºæ²¡æœ‰é¢„ç®—çš„è®¡åˆ’ï¼Œä½†é¢„ç®—å¯¹æ¯”åŠŸèƒ½ä¸ä¼šæ˜¾ç¤ºã€‚

## ğŸ› å·²çŸ¥é—®é¢˜

ç›®å‰æ²¡æœ‰å·²çŸ¥çš„ä¸¥é‡é—®é¢˜ã€‚å¦‚æœåœ¨æµ‹è¯•ä¸­å‘ç°é—®é¢˜ï¼Œè¯·è®°å½•å¹¶åé¦ˆã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“– [STAGE5_SETUP.md](./STAGE5_SETUP.md) - é…ç½®æŒ‡å—
- ğŸ“– [STAGE5_DATABASE_SETUP.md](./STAGE5_DATABASE_SETUP.md) - æ•°æ®åº“è®¾ç½®
- ğŸ“– [STAGE5_TEST_GUIDE.md](./STAGE5_TEST_GUIDE.md) - æµ‹è¯•æŒ‡å—

## ğŸŠ ä¸‹ä¸€é˜¶æ®µå±•æœ›

ç¬¬äº”é˜¶æ®µå®Œæˆåï¼Œæ‚¨å¯ä»¥è€ƒè™‘ä»¥ä¸‹æ‰©å±•åŠŸèƒ½ï¼š

- ğŸ“Š **é«˜çº§ç»Ÿè®¡**ï¼šæ›´å¤šå›¾è¡¨ç±»å‹ï¼ˆæŠ˜çº¿å›¾ã€é›·è¾¾å›¾ï¼‰
- ğŸ’± **å¤šè´§å¸æ”¯æŒ**ï¼šå›½é™…æ—…è¡Œè´§å¸è½¬æ¢
- ğŸ§¾ **å‘ç¥¨ä¸Šä¼ **ï¼šOCR è¯†åˆ«ç¥¨æ®
- ğŸ“¤ **å¯¼å‡ºåŠŸèƒ½**ï¼šå¯¼å‡ºä¸º Excel/PDF
- ğŸ”” **é¢„ç®—æé†’**ï¼šæ¥è¿‘é¢„ç®—æ—¶æ¨é€é€šçŸ¥
- ğŸ‘¥ **å¤šäººåˆ†è´¦**ï¼šå›¢é˜Ÿæ—…è¡Œ AA åˆ¶
- ğŸ“ **åœ°ç†ç»Ÿè®¡**ï¼šæŒ‰åœ°ç‚¹ç»Ÿè®¡æ¶ˆè´¹

---

**æ­å–œå®Œæˆç¬¬äº”é˜¶æ®µå¼€å‘ï¼** ğŸ‰

ç°åœ¨è¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤åº”ç”¨æ•°æ®åº“è¿ç§»å¹¶è¿›è¡Œæµ‹è¯•ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶åé¦ˆï¼

