# 渐进式生成测试指南

## 🎯 测试目标

验证渐进式生成功能的：
1. ✅ 稳定性（成功率）
2. ✅ 进度显示
3. ✅ 错误处理
4. ✅ 行程质量

## 📋 前置准备

### 1. 确认环境

```bash
# 检查 DeepSeek API 配置
npm run dev
```

打开浏览器控制台，访问: http://localhost:3000/api/test-deepseek

应该看到:
```json
{
  "success": true,
  "message": "DeepSeek API 连接成功",
  "duration": "XXXms"
}
```

### 2. 登录系统

1. 访问 http://localhost:3000
2. 登录到你的账号
3. 进入仪表板

## 🧪 测试案例

### 测试 1: 2天短行程（基准测试）

**目的**: 验证基本功能

**步骤**:
1. 点击"创建新计划"
2. 填写表单:
   - 目的地: `北京`
   - 开始日期: `2025-02-01`
   - 结束日期: `2025-02-02`
   - 预算: `2000`
3. 点击"生成计划"

**预期结果**:
- ✅ 显示进度条
- ✅ 进度从 0% → 100%
- ✅ 显示"正在生成第 1 天行程..."等消息
- ✅ 约 20-40 秒完成
- ✅ 生成成功，显示 2 天完整行程

**观察终端日志**:
```bash
🔄 使用渐进式生成模式...
✅ 计划概要生成完成
📅 开始生成第 1/2 天...
✅ 第 1 天生成成功（X 个活动）
📅 开始生成第 2/2 天...
✅ 第 2 天生成成功（X 个活动）
📝 开始生成行程总结...
✅ 渐进式生成完成！
```

---

### 测试 2: 5天中等行程（压力测试）

**目的**: 验证中等长度行程的稳定性

**步骤**:
1. 点击"创建新计划"
2. 填写表单:
   - 目的地: `成都`
   - 开始日期: `2025-03-10`
   - 结束日期: `2025-03-14`
   - 预算: `5000`
   - 偏好: `美食, 文化`
3. 点击"生成计划"

**预期结果**:
- ✅ 显示进度条，约 60-120 秒完成
- ✅ 每天都有 3-5 个活动
- ✅ 每天有早中晚餐安排
- ✅ 活动类型多样（景点、餐厅、交通等）
- ✅ 预算分配合理

**验证行程质量**:
- [ ] 第一天是否从早上开始？
- [ ] 每天活动时间是否连贯？
- [ ] 是否有重复的景点或餐厅？
- [ ] 总预算是否接近输入的 5000 元？

---

### 测试 3: 7天长行程（极限测试）

**目的**: 验证最长行程的成功率

**步骤**:
1. 点击"创建新计划"
2. 填写表单:
   - 目的地: `云南（昆明-大理-丽江）`
   - 开始日期: `2025-04-01`
   - 结束日期: `2025-04-07`
   - 预算: `8000`
   - 偏好: `自然风光, 休闲`
3. 点击"生成计划"

**预期结果**:
- ✅ 约 120-180 秒完成
- ✅ 7 天完整行程
- ✅ 包含昆明、大理、丽江的景点
- ✅ 有城市间交通安排

**特别观察**:
- [ ] 是否有某天生成失败并自动重试？
- [ ] 终端日志中是否有"⚠️ 第 X 天生成失败（尝试 Y/3）"？
- [ ] 重试后是否成功？

**终端日志示例**:
```bash
📅 开始生成第 4/7 天...
⚠️ 第 4 天生成失败（尝试 1/3）: 活动列表为空
📅 开始生成第 4/7 天...（重试）
✅ 第 4 天生成成功（4 个活动）
```

---

### 测试 4: 语音输入 + 渐进式生成（集成测试）

**目的**: 验证语音输入与生成的完整流程

**步骤**:
1. 点击"创建新计划"
2. 找到"目的地"字段，点击麦克风图标
3. 说话: "我想去杭州旅游"
4. 点击"停止录音" → "确认提交"
5. 继续填写其他字段:
   - 开始日期: `2025-05-01`
   - 结束日期: `2025-05-03`
   - 预算: `3000`
6. 在"特殊需求"字段，再次使用语音输入
7. 说话: "我想看西湖，品尝龙井茶，住民宿"
8. 点击"生成计划"

**预期结果**:
- ✅ 语音识别准确
- ✅ 目的地和特殊需求正确填充
- ✅ 生成的行程包含西湖、龙井茶等相关内容
- ✅ 3 天行程完整生成

---

### 测试 5: 错误处理（边界测试）

**目的**: 验证错误处理机制

#### 5a. API 超时模拟

**步骤**:
1. 临时修改 `src/lib/ai/ai-config.ts`，将 `timeout` 设为 `5000`（5秒）
2. 尝试生成 5 天行程
3. 应该会超时失败

**预期结果**:
- ✅ 显示清晰的错误信息
- ✅ 不会无限等待
- ✅ 可以再次尝试

#### 5b. 无效输入

**步骤**:
1. 创建新计划
2. 只填写目的地，其他留空
3. 点击"生成计划"

**预期结果**:
- ✅ 显示表单验证错误
- ✅ 不会发送请求

#### 5c. 结束日期早于开始日期

**步骤**:
1. 创建新计划
2. 开始日期: `2025-03-10`
3. 结束日期: `2025-03-05`（早于开始日期）
4. 点击"生成计划"

**预期结果**:
- ✅ 显示"结束日期必须晚于开始日期"错误
- ✅ 不会发送请求

---

## 📊 性能指标

### 成功率目标

| 行程天数 | 目标成功率 | 实际成功率 |
|---------|-----------|-----------|
| 2-3天 | ≥ 95% | _____ % |
| 4-5天 | ≥ 90% | _____ % |
| 6-7天 | ≥ 85% | _____ % |

### 时间指标

| 行程天数 | 目标时间 | 实际时间 |
|---------|---------|---------|
| 2天 | ≤ 45秒 | _____ 秒 |
| 3天 | ≤ 60秒 | _____ 秒 |
| 5天 | ≤ 120秒 | _____ 秒 |
| 7天 | ≤ 180秒 | _____ 秒 |

### 质量指标

对于每个生成的计划，检查：

- [ ] 每天有 3-5 个活动
- [ ] 包含早中晚餐
- [ ] 时间安排合理（不会上午10点后才开始）
- [ ] 活动类型多样化
- [ ] 总预算接近输入预算
- [ ] 有实用的提示和建议

---

## 🐛 已知问题记录

在测试过程中，如果遇到问题，请记录：

### 问题模板

```
【问题】简短描述
【测试案例】测试X
【复现步骤】
1. ...
2. ...
【预期】...
【实际】...
【终端日志】
```
...
```
【截图】（如果有）
```

---

## 🎉 测试完成标准

完成以上所有测试案例，并满足：

- ✅ 测试 1-3 全部成功
- ✅ 测试 4 语音集成功能正常
- ✅ 测试 5 错误处理符合预期
- ✅ 成功率达标（2-3天 ≥ 95%）
- ✅ 生成的行程质量合格
- ✅ 进度显示正常
- ✅ 无严重 Bug

---

## 📝 测试报告模板

完成测试后，填写以下报告：

```markdown
# 渐进式生成测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: 你的名字
**版本**: v2.0.0

## 测试结果汇总

| 测试案例 | 状态 | 时间 | 备注 |
|---------|------|------|------|
| 测试1: 2天行程 | ✅/❌ | XX秒 | ... |
| 测试2: 5天行程 | ✅/❌ | XX秒 | ... |
| 测试3: 7天行程 | ✅/❌ | XX秒 | ... |
| 测试4: 语音集成 | ✅/❌ | XX秒 | ... |
| 测试5: 错误处理 | ✅/❌ | - | ... |

## 性能数据

- 2天行程平均时间: XX秒
- 5天行程平均时间: XX秒
- 7天行程平均时间: XX秒
- 总体成功率: XX%

## 发现的问题

1. ...
2. ...

## 建议和改进

1. ...
2. ...

## 总体评价

✅ 通过 / ⚠️ 有问题 / ❌ 不通过

---
```

## 🚀 下一步

测试通过后，可以：

1. 部署到生产环境
2. 向用户开放功能
3. 收集真实使用反馈
4. 继续优化和改进

---

**祝测试顺利！** 🎊

